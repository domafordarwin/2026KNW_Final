# TASKS: 개발 작업 단위 체크리스트

본 Tasks는 다음을 핵심 목표로 한다.
- 역할 분리(관리자/학교담당자/검사진행교사/학생/학부모)
- AI 분석(항목별 처리 → 통합) + 스키마 검증
- 교사 검수·첨삭·승인 워크플로
- 최종 보고서에 AI+교사 반영
- 추천 도서 allowlist 강제

---

## 0. 인프라/프로젝트 기초

- [ ] T-00-01 레포 구조 구성(apps/web, apps/api, workers, packages/shared, docs)
- [ ] T-00-02 환경변수/시크릿 관리(OpenAI, DB, Storage, Queue)
- [ ] T-00-03 RBAC/세션 인증 스캐폴딩(Admin/SchoolManager/Teacher/Student/Parent)
- [ ] T-00-04 Object Storage 연동(PDF 저장) + signed URL 발급 모듈
- [ ] T-00-05 Queue/Worker 구축(제출 이벤트 처리, 리포트 생성 작업)
- [ ] T-00-06 감사로그/모니터링(LLM 비용, 실패율, 생성 지연)

---

## 1. 관리자(Admin Console)

### 1.1 문항/검사버전
- [ ] T-01-01 지문(passages) CRUD + 검색/필터(학년군/태그)
- [ ] T-01-02 문항(items) CRUD + 메타(영역/하위지표/난이도/유형/배점)
- [ ] T-01-03 정답키/루브릭 등록 UI + 서버 유효성 검사(누락/포맷)
- [ ] T-01-04 검사 버전 발행(assessment_version_items 스냅샷 고정)
- [ ] T-01-05 문항 미리보기/검증(버전별 랜더링)

### 1.2 추천 도서 Allowlist
- [ ] T-01-06 도서(book_catalog) CRUD(활성/비활성)
- [ ] T-01-07 CSV 업로드/검증(필수 컬럼 체크, 중복/ISBN 정리)
- [ ] T-01-08 allowlist 정책 페이지(목록 외 추천 금지 on/off, 로그 확인)

---

## 2. 학교 담당자(SchoolManager)

- [ ] T-02-01 학생 계정 일괄 업로드(CSV) + 초기 비밀번호 발급/초기화
- [ ] T-02-02 학급/학년 편성 및 재적 상태 관리(전출/휴학 등 정책)
- [ ] T-02-03 학교 단위 대시보드 API(영역/하위지표/성향 분포)
- [ ] T-02-04 학교 전체 보고서 생성/이력/다운로드(PDF)
- [ ] T-02-05 교사 권한 부여/학급 접근 범위 설정(옵션)

---

## 3. 검사 진행 교사(Teacher) - 검사 운영

- [ ] T-03-01 검사 세션 생성(버전, 학급, 기간, 재응시 정책)
- [ ] T-03-02 배부(코드/링크/QR) + 진행 현황 UI(실시간/폴링)
- [ ] T-03-03 학생 응시 상태 관리(재응시 승인, 제출 잠금/해제, 무효 처리)
- [ ] T-03-04 제출 이벤트 발행(submission.completed) 및 파이프라인 트리거

---

## 4. 채점/지표/성향(규칙 기반)

- [ ] T-04-01 선택형 자동채점 엔진(answer_key 매칭)
- [ ] T-04-02 서술형 루브릭 채점 엔진(요소별 breakdown 저장)
- [ ] T-04-03 영역/하위지표 점수 산출 + 백분위/등급 계산
- [ ] T-04-04 독자성향(A~D) 규칙 판정 + 점수 저장(유형 고정)

---

## 5. OpenAI(LLM) 파이프라인: 항목별 → 통합

### 5.1 공통(클라이언트/검증/가드레일)
- [ ] T-05-01 OpenAI 클라이언트 래퍼(재시도/레이트리밋/타임아웃)
- [ ] T-05-02 입력 해시 기반 캐시(동일 입력 재호출 방지)
- [ ] T-05-03 JSON 스키마 정의/validator(output_validator)
- [ ] T-05-04 PII redaction(집계/LLM 입력 전에 익명화)

### 5.2 단계별 작업
- [ ] T-05-05 Step1 Item Analyzer(문항 단위) 구현(입력/출력 저장)
- [ ] T-05-06 Step2 Subskill/Domain Synthesis 구현
- [ ] T-05-07 Step3 Trait Explanation(유형은 규칙값 고정, 해석만 생성) 구현
- [ ] T-05-08 Step4 Integrated Composer(통합 요약/지도 방향/학부모 요약) 구현
- [ ] T-05-09 Step5 School Synthesis(집계형 인사이트) 구현
- [ ] T-05-10 실패 fallback(규칙 템플릿 기반 최소 산출물) 구현

---

## 6. 추천 도서/지도안(Allowlist 강제)

- [ ] T-06-01 Book 후보 생성(규칙 필터: 학년군/난이도/태그/분량)
- [ ] T-06-02 Book-only Guidance LLM 호출(입력: 후보 book_id+메타)
- [ ] T-06-03 allowlist_books_enforcer(출력 book_id 검증, 재시도, 대체)
- [ ] T-06-04 교사용 도서 선택 UI(후보 목록, 순서 변경, 활동 편집)

---

## 7. 교사 피드백 워크스페이스(검수/첨삭/승인)

- [ ] T-07-01 학생별 AI 피드백 뷰(섹션별) + 근거 패널(문항/지표)
- [ ] T-07-02 교사 편집본 저장(content_json) + diff_json 생성
- [ ] T-07-03 문장 주석(코멘트) + 공개/비공개 설정
- [ ] T-07-04 섹션 단위 AI 재생성(대안 카드 방식, 덮어쓰기 금지)
- [ ] T-07-05 승인(Approve) 워크플로 + 잠금(Lock) + 감사로그
- [ ] T-07-06 승인 상태에 따른 보고서 생성 제한 정책(승인 전 초안/워터마크 등)

---

## 8. 보고서 생성/웹 열람/PDF 다운로드 (AI + 교사 반영)

- [ ] T-08-01 템플릿 구현(학생/학부모/학교) + 스타일 가이드
- [ ] T-08-02 병합 규칙 엔진(교사 승인본 우선 + AI 참고/대체)
- [ ] T-08-03 PDF 생성 워커(Puppeteer/Chromium) + 저장/버전 관리
- [ ] T-08-04 PDF 뷰어(PDF.js) + 다운로드(signed URL) UI
- [ ] T-08-05 학부모 공유 링크(토큰/만료) + 접근 통제

---

## 9. 테스트/운영

- [ ] T-09-01 역할별 RBAC 테스트(교차 접근 차단)
- [ ] T-09-02 allowlist 위반 탐지/차단 테스트(텍스트 도서명 포함)
- [ ] T-09-03 LLM 스키마 위반/실패 fallback 테스트
- [ ] T-09-04 대량 제출/대량 리포트 생성 성능 테스트
- [ ] T-09-05 보고서 재현성 테스트(스냅샷 버전 고정 확인)
